<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<ui:composition template="/views/template.xhtml">
	<ui:define name="title">
		<h:outputText value="XLRA - create quotation" />
	</ui:define>
	<ui:define name="pageTitle">
		<h:outputText value="Create quotation" />
	</ui:define>
	<ui:define name="body">
		<h:form id="createQuotationForm">
			<p:messages id="messages" showDetail="true" autoUpdate="true"
				closable="true" />
			<p:wizard flowListener="#{createQuotationController.onFlowProcess}"
				showNavBar="false" widgetVar="wizard">
				<p:tab id="selectCustomer" title="Select / create customer">

					<h:outputText value="Select an existing customer: " />
					<p:autoComplete size="50" id="customerSelector" dropdown="true"
						value="#{createQuotationController.quotationQuery.customer}"
						completeMethod="#{createQuotationController.completeCustomerName}"
						var="customer" itemLabel="#{customer.name}" required="true"
						itemValue="#{customer}" converter="#{customerConverter}">
					</p:autoComplete>

					<p:commandButton value="Create new customer"
						update=":addQuickCustomerForm" immediate="true"
						onclick="PF('addCustomerDialog').show();" />

					<p:panel
						style="margin-top:20px; bottom:20px;  padding:0px;border:0px;">
						<p:commandButton value="Next" onclick="PF('wizard').next();"
							style="width:150px; margin-left:20px;" />
					</p:panel>
				</p:tab>
				<p:tab id="selectFiltersTab" title="Rate filters">
					<p:panelGrid columns="2">
						<h:outputText value="Country: " />
						<p:selectOneRadio converter="#{countryConverter}" required="true"
							value="#{createQuotationController.quotationQuery.country}">
							<f:selectItems value="#{createQuotationController.allCountries}" />
						</p:selectOneRadio>

						<h:outputText value="Measurement: " />
						<p:selectOneRadio required="true"
							value="#{createQuotationController.quotationQuery.measurement}">
							<f:selectItems
								value="#{createQuotationController.allMeasurements}" />
						</p:selectOneRadio>

						<h:outputText value="Type: " />
						<p:selectOneRadio required="true"
							value="#{createQuotationController.quotationQuery.kindOfRate}">
							<f:selectItems value="#{createQuotationController.allKinds}" />
						</p:selectOneRadio>


						<h:outputText value="Quantity:" />
						<p:inputText required="true" style="width:100%;"
							value="#{createQuotationController.quotationQuery.quantity}" />

						<h:outputText value="Postal code: " />
						<p:inputText required="true" style="width:100%;"
							value="#{createQuotationController.quotationQuery.postalCode}" />

					</p:panelGrid>
					<p:panel style="bottom:20px;  padding:0px;border:0px;">
						<p:commandButton value="Back" onclick="PF('wizard').back();"
							style="width:150px;" />
						<p:commandButton value="Next" onclick="PF('wizard').next();"
							style="width:150px; margin-left:20px;" />
					</p:panel>
				</p:tab>

				<p:tab id="summaryOfferteTab" title="Summary">

				</p:tab>
			</p:wizard>
		</h:form>
		<p:dialog header="Add condition" widgetVar="addCustomerDialog"
			modal="true" height="480px" width="900px" dynamic="true">
			<h:form id="addQuickCustomerForm">
				<p:panel header="Add customer" style="margin-top:50px;">
					<p:growl showDetail="true" id="growl" sticky="true" />
					<p:panelGrid columns="2" style="width:100%;">
						<h:outputLabel for="nameField">Name</h:outputLabel>
						<p:inputText size="50" style="width:100%;"
							value="#{createQuotationController.customerToAdd.name}"
							id="nameField"></p:inputText>

						<h:outputLabel for="emailField">Email</h:outputLabel>
						<p:inputText size="50" style="width:100%;"
							value="#{createQuotationController.customerToAdd.email}"
							id="emailField"></p:inputText>

						<h:outputLabel for="phoneField">Phone</h:outputLabel>
						<p:inputText size="50" style="width:100%;"
							value="#{createQuotationController.customerToAdd.phone}"
							id="phoneField"></p:inputText>

						<h:outputLabel for="languageField">Language</h:outputLabel>
						<p:selectOneRadio
							value="#{createQuotationController.customerToAdd.language}"
							id="languageField">
							<f:selectItems value="#{createQuotationController.allLanguages}"></f:selectItems>
						</p:selectOneRadio>
					</p:panelGrid>
					<p:commandButton value="Save customer"
						update=":createQuotationForm :addQuickCustomerForm growl "
						actionListener="#{createQuotationController.createCustomer}"
						ajax="true"
						oncomplete="handleAddCustomerRequest(xhr, status, args)" />
				</p:panel>
			</h:form>
		</p:dialog>
		<script type="text/javascript">
			function handleAddCustomerRequest(xhr, status, args) {
				if (args.validationFailed) {
					PF('addCustomerDialog').jq.effect("shake", {
						times : 5
					}, 100);
				} else {
					PF('addCustomerDialog').hide();
				}
			}
		</script>
	</ui:define>
</ui:composition>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
	<p:panel id="conditionsDetailPanel"
		toggleable="#{controller.hasRateFileSelected}"
		collapsed="#{controller.collapseConditionsDetailGrid}"
		header="Terms and conditions">

		<p:dataTable editable="#{canEdit}" value="#{conditions}"
			var="condition" editMode="row" emptyMessage="No conditions found."
			id="conditionTable">
			<p:column headerText="Key" width="15%">
				<h:outputText value="#{condition.translatedKey}" />
			</p:column>
			<p:column headerText="Condition type" width="15%">
				<h:outputText value="#{condition.conditionType}" />
			</p:column>
			<p:column headerText="Value">
				<p:outputPanel rendered="#{condition.calculationCondition}">
					<h:outputText value="#{condition.value}" />
				</p:outputPanel>
				<p:outputPanel rendered="#{!condition.calculationCondition}">
					<h:outputText
						value="EN: #{condition.englishTranslation.translation}" />
					<br />
					<h:outputText value="NL: #{condition.dutchTranslation.translation}" />
					<br />
					<h:outputText
						value="FR: #{condition.frenchTranslation.translation}" />
					<br />
					<h:outputText
						value="DE: #{condition.germanTranslation.translation}" />
					<br />
				</p:outputPanel>
			</p:column>
			<p:column headerText="Standard option" style="width:128px;">
				<p:selectBooleanCheckbox value="#{condition.standardSelected}"
					disabled="true" />
			</p:column>
			<p:column style="width:105px;" rendered="#{canEdit}">
				<p:commandButton icon="ui-icon-pencil" title="Edit"
					actionListener="#{controller.setupEditCondition(condition)}"
					ajax="true" immediate="true" update=":conditionsDetailForm">
				</p:commandButton>
				<p:commandButton style="margin-left:5px;" icon="ui-icon-trash"
					title="Delete"
					actionListener="#{controller.deleteCondition(condition)}"
					ajax="true" immediate="true" update=":conditionsDetailForm">
					<p:confirm header="Confirm delete"
						message="Are you sure you want to delete?" icon="ui-icon-alert" />
				</p:commandButton>
			</p:column>
		</p:dataTable>
		<p:commandButton value="Add condition" rendered="#{canEdit}"
			onclick="PF('addConditionDialog').show();" />

		<p:dialog id="editDialog" header="Edit condition"
			widgetVar="editConditionDialog" modal="true" width="50%" height="50%"
			dynamic="true">
			<p:panel style="width:80%; margin:auto;">
				<h:outputLabel style="font-weight:bold;"
					value="#{controller.selectedCondition.translatedKey}" />
				<p:panelGrid columns="2" style="width:100%;margin-top:10px;">

					<h:outputLabel value="New value:"
						rendered="#{controller.selectedCondition.calculationCondition}" />
					<p:inputText size="50"
						value="#{controller.selectedCondition.value}"
						rendered="#{controller.selectedCondition.calculationCondition}" />

					<c:forEach items="#{controller.selectedCondition.translations}"
						var="translation">
						<h:outputText value="#{translation.language}" />
						<p:inputText size="50" value="#{translation.translation}" />
					</c:forEach>
				</p:panelGrid>
				<f:facet name="footer">
					<p:commandButton value="Cancel"
						onclick="PF('editConditionDialog').hide();" />
					<p:commandButton style="margin-left:20px;" value="Save"
						oncomplete="handleAddCustomerRequest(xhr, status, args)"
						actionListener="#{controller.saveEditCondition}"
						update=":conditionsDetailForm" />
				</f:facet>
			</p:panel>
		</p:dialog>

		<p:dialog id="addDialog" header="Add condition"
			widgetVar="addConditionDialog" modal="true" height="150px"
			width="300px" dynamic="true">
			<p:selectOneMenu value="#{controller.keyToAdd}" style="width:200px;">
				<f:selectItems
					value="#{controller.availableTranslationKeysForSelectedRateFile}" />
			</p:selectOneMenu>
			<f:facet name="footer">
				<p:commandButton value="Cancel"
					onclick="PF('editConditionDialog').hide();" />
				<c:if test="${controllerName == 'manageRatesController'}">
					<p:commandButton value="Add condition"
						actionListener="#{manageRatesController.createConditionForSelectedTranslationKey}"
						ajax="true" update=":conditionsDetailForm" />
				</c:if>
				<c:if test="${controllerName == 'createRatesController'}">
					<p:commandButton value="Add condition"
						actionListener="#{createRatesController.createConditionForSelectedTranslationKey}"
						ajax="true" update=":conditionsDetailForm" />
				</c:if>
			</f:facet>
		</p:dialog>
		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
			<p:commandButton value="Yes" type="button"
				styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			<p:commandButton value="No" type="button"
				styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		</p:confirmDialog>
	</p:panel>
	<script type="text/javascript">
		function handleAddCustomerRequest(xhr, status, args) {
			if (args.validationFailed) {
				PF('editConditionDialog').jq.effect("shake", {
					times : 5
				}, 100);
			} else {
				PF('editConditionDialog').hide();
			}
		}
	</script>
</ui:composition>
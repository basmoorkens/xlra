<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
	<h:form id="summaryForm">
		<p:panel id="summaryPanel" header="Summary"
			collapsed="#{createQuotationController.collapseSummaryPanel}"
			toggleable="false">
			<p:panelGrid columns="2" style="margin-bottom:20px;width:100%;"
				columnClasses="labelColumn,valuesColumn">
				<h:outputText value="Used ratefile: " />
				<h:outputText
					value="#{createQuotationController.quotationResult.usedRateFileName}" />

				<h:outputText value="Receipients: " />
				<p:panelGrid columns="2">
					<h:outputText
						value="#{createQuotationController.quotationResult.emailResult.recipientsAsString}" />
					<p:commandButton value="Add/Remove recipients"
						onclick="PF('alterRecipients').show();" />
				</p:panelGrid>

				<h:outputText value="Subject: " />
				<p:inputText size="100" style="width:100%;"
					value="#{createQuotationController.quotationResult.emailResult.subject}" />
			</p:panelGrid>

			<h:outputText value="Generated email:" />
			<p:editor height="350"
				value="#{createQuotationController.quotationResult.emailResult.email}" />
			<p:panel style="margin-top:20px;">
				<p:commandButton value="Back"
					style="padding-left:5px; padding-right:5px; margin-right:20px;"
					update=":summaryForm :optionsForm" immediate="true"
					id="backButton3"
					actionListener="#{createQuotationController.showOptionsPanel}" />
				<p:tooltip id="backTip3" for="backButton3"
					value="Go back to options selection" />
				<p:commandButton styleClass="navButton" value="Open pdf"
					id="openPdfButton"
					actionListener="#{createQuotationController.downloadPdf}"
					onclick="this.form.target='_blank'" ajax="false" />
				<p:tooltip id="openPdfTip" for="openPdfButton"
					value="Open the generated PDF" />
				<p:commandButton value="Send offerte"
					update=":resultForm :summaryForm" id="nextButton4"
					actionListener="#{createQuotationController.submitOfferte}"
					styleClass="navButton" ajax="true" />
				<p:tooltip for="nextButton4" id="nextTip4"
					value="Send the offerte to the customer" />
			</p:panel>
		</p:panel>
		<p:ajaxStatus onstart="showStatusDialog();"
			onsuccess="hideStatusDialog();" />

		<p:dialog id="statusDialog" widgetVar="statusDialog" modal="true"
			draggable="false" closable="false" resizable="false"
			showHeader="false">
			<p:graphicImage url="/resources/images/ajax-loader.gif" />
		</p:dialog>

		<p:dialog id="alterRecipientsDialog" header="Add/Remove recipients"
			widgetVar="alterRecipientsDialog" modal="true" width="70%"
			height="50%">
			<p:panel>
				<p:panelGrid columns="2" style="width:100%;">
					<h:outputLabel for="emailField">Add recipient</h:outputLabel>
					<p:inputText style="width:100%;"
						value="#{createQuotationController.manualAddedEmail}"
						validatorMessage="Pleas enter a valid email address"
						id="emailField">
						<f:validateRegex
							pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
					</p:inputText>
				</p:panelGrid>
			</p:panel>
		</p:dialog>

	</h:form>
</ui:composition>